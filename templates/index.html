<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>FirstPass</title>
	<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
	<div class="max-w-5xl mx-auto py-10">
		<h1 class="text-2xl font-bold mb-6 text-gray-800 px-4">Inbox: New Opportunities</h1>
		
		<div id="job-list" class="bg-white shadow-sm border rounded-lg divide-y">
		</div>
	</div>

	<script>
		async function fetchJobs() {
			console.log("Attempting to fetch jobs...");
			try {
				const response = await fetch('/api/jobs');
				if (!response.ok) throw new Error('Network response was not ok');
				
				const jobs = await response.json();
				console.log("Jobs received:", jobs);
				
				const container = document.getElementById('job-list');
				if (!container) return;

				if (jobs.length === 0) {
					container.innerHTML = '<p class="p-8 text-center text-gray-500">No new applications. Rest up!</p>';
					return;
				}

				let htmlContent = '';
				jobs.forEach(job => {
					htmlContent += `
						<div class="flex items-center justify-between p-4 hover:bg-blue-50 transition group">
							<a href="${job.link}" target="_blank" class="flex-1 flex items-center decoration-transparent">
								<span class="font-bold text-gray-900 w-48 inline-block truncate">${job.company}</span>
								<span class="text-gray-600 truncate">${job.role}</span>
								<span class="ml-2 px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">${job.source}</span>
							</a>
							<div class="flex space-x-2 opacity-0 group-hover:opacity-100 transition">
								<button onclick="handleAction(${job.id}, 'save')" class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 text-sm shadow-sm">Save to Email</button>
								<button onclick="handleAction(${job.id}, 'delete')" class="px-3 py-1 bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-100 text-sm shadow-sm">Delete</button>
							</div>
						</div>`;
				});
				container.innerHTML = htmlContent;
			} catch (error) {
				console.error("Error in fetchJobs:", error);
			}
		}

    async function handleAction(id, action) {
			console.log(`Performing ${action} on job ${id}`);
			const response = await fetch('/api/action', {
				method: 'POST',
				headers: {'Content-Type': 'application/json'},
				body: JSON.stringify({ id, action })
			});
			if (response.ok) {
				fetchJobs(); // Refresh
			}
    }

    // Initialize once the page is fully loaded
    window.onload = () => {
			fetchJobs();
			setInterval(fetchJobs, 600000);
    };
	</script>
</body>
</html>